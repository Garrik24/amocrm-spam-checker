# amoCRM Spam Checker üö´üìû

–°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ö–æ–¥—è—â–∏—Ö –∑–≤–æ–Ω–∫–æ–≤ –Ω–∞ —Å–ø–∞–º —á–µ—Ä–µ–∑ SpravPortal API.

–ü—Ä–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–∏ —Å–ø–∞–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Å–¥–µ–ª–∫—É –≤ —Å—Ç–∞—Ç—É—Å "–°–ü–ê–ú" –≤ amoCRM.

## üéØ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–µ—Ä–≤–∏—Å?

```
–í—Ö–æ–¥—è—â–∏–π –∑–≤–æ–Ω–æ–∫ ‚Üí Webhook ‚Üí –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–º–µ—Ä–∞ ‚Üí –°–ü–ê–ú? ‚Üí –î–∞ ‚Üí –ü–µ—Ä–µ–≤–æ–¥ –≤ —Å—Ç–∞—Ç—É—Å –°–ü–ê–ú
                                                  ‚Üí –ù–µ—Ç ‚Üí –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ "–ù–æ–º–µ—Ä —á–∏—Å—Ç—ã–π"
```

1. –ü–æ–ª—É—á–∞–µ—Ç webhook —Å –Ω–æ–º–µ—Ä–æ–º —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ ID —Å–¥–µ–ª–∫–∏
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–æ–º–µ—Ä —á–µ—Ä–µ–∑ [SpravPortal API](https://www.spravportal.ru/)
3. –ï—Å–ª–∏ **–°–ü–ê–ú** ‚Üí –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Å–¥–µ–ª–∫—É –≤ —Å—Ç–∞—Ç—É—Å "–°–ü–ê–ú" + –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ
4. –ï—Å–ª–∏ **—á–∏—Å—Ç—ã–π** ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ –≤ –∫–∞—Ä—Ç–æ—á–∫—É —Å–¥–µ–ª–∫–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –Ω–∞ Railway

### 1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub

### 2. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ Railway
1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ [railway.app](https://railway.app)
2. New Project ‚Üí Deploy from GitHub repo
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

### 3. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–í Railway: Settings ‚Üí Variables ‚Üí Add

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------------|----------|--------|
| `SPRAVPORTAL_API_KEY` | –ö–ª—é—á API SpravPortal | `test-X1R7B8VQM2KC` |
| `AMOCRM_DOMAIN` | –î–æ–º–µ–Ω amoCRM | `https://stavgeo26.amocrm.ru` |
| `AMOCRM_ACCESS_TOKEN` | –¢–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ amoCRM | `eyJ0eXAi...` |
| `AMOCRM_SPAM_STATUS_ID` | ID —Å—Ç–∞—Ç—É—Å–∞ –°–ü–ê–ú | `12345678` |
| `AMOCRM_SPAM_PIPELINE_ID` | ID –≤–æ—Ä–æ–Ω–∫–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –°–ü–ê–ú | `1234567` |
| `SPAM_THRESHOLD` | –ü–æ—Ä–æ–≥ —Å–ø–∞–º–∞ (0-100) | `50` |

### 4. –ü–æ–ª—É—á–∏—Ç–µ URL —Å–µ—Ä–≤–∏—Å–∞
–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è Railway –¥–∞—Å—Ç –≤–∞–º URL –≤–∏–¥–∞:
```
https://your-app-name.up.railway.app
```

### 5. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Webhook –≤ amoCRM –∏–ª–∏ Make.com
–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ URL: `https://your-app.up.railway.app/webhook/check-spam`

## üì° API Endpoints

### `POST /webhook/check-spam`
–û—Å–Ω–æ–≤–Ω–æ–π webhook –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–º–µ—Ä–∞.

**Request:**
```json
{
  "phone": "79001234567",
  "lead_id": 12345
}
```

**Response (–°–ü–ê–ú):**
```json
{
  "success": true,
  "status": "SPAM",
  "phone": "79001234567",
  "spamScore": 85,
  "category": "–¢–µ–ª–µ—Ñ–æ–Ω–Ω–æ–µ –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ",
  "message": "–°–¥–µ–ª–∫–∞ 12345 –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –≤ —Å—Ç–∞—Ç—É—Å –°–ü–ê–ú"
}
```

**Response (–ß–∏—Å—Ç—ã–π):**
```json
{
  "success": true,
  "status": "CLEAN",
  "phone": "79001234567",
  "spamScore": 10,
  "message": "–ù–æ–º–µ—Ä —á–∏—Å—Ç—ã–π, –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ"
}
```

---

### `POST /webhook/amocrm`
Webhook –≤ —Ñ–æ—Ä–º–∞—Ç–µ amoCRM Digital Pipeline.

---

### `GET /test/check?phone=79001234567`
–¢–µ—Å—Ç–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ–º–µ—Ä–∞ (–±–µ–∑ –∑–∞–ø–∏—Å–∏ –≤ amoCRM).

**Response:**
```json
{
  "success": true,
  "result": {
    "phone": "79001234567",
    "isSpam": false,
    "spamScore": 10,
    "category": "unknown",
    "reviewsCount": 0,
    "organization": null,
    "region": "–ö—Ä–∞—Å–Ω–æ–¥–∞—Ä—Å–∫–∏–π –∫—Ä–∞–π",
    "operator": "–ú–µ–≥–∞–§–æ–Ω"
  }
}
```

---

### `GET /`
–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–∞ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

---

### `GET /health`
Health check –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

## üîß –ö–∞–∫ —É–∑–Ω–∞—Ç—å ID —Å—Ç–∞—Ç—É—Å–∞ –∏ –≤–æ—Ä–æ–Ω–∫–∏ –≤ amoCRM

### ID –≤–æ—Ä–æ–Ω–∫–∏ (pipeline_id):
1. –û—Ç–∫—Ä–æ–π—Ç–µ amoCRM ‚Üí –°–¥–µ–ª–∫–∏
2. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—É—é –≤–æ—Ä–æ–Ω–∫—É
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ URL: `/leads/pipeline/**1234567**/`

### ID —Å—Ç–∞—Ç—É—Å–∞ (status_id):
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ª—é–±—É—é —Å–¥–µ–ª–∫—É –≤ –Ω—É–∂–Ω–æ–º —Å—Ç–∞—Ç—É—Å–µ
2. –í URL –Ω–∞–π–¥–∏—Ç–µ: `?status_id=**12345678**`

–ò–ª–∏ —á–µ—Ä–µ–∑ API:
```bash
curl "https://your-domain.amocrm.ru/api/v4/leads/pipelines" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

## üîê –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å Access Token amoCRM

1. amoCRM ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
2. –°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ:
   - –ù–∞–∑–≤–∞–Ω–∏–µ: "Spam Checker"
   - –°—Å—ã–ª–∫–∞ –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è: `https://your-app.up.railway.app`
4. –ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—É—á–∏—Ç–µ:
   - Client ID
   - Client Secret
   - –ö–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
5. –û–±–º–µ–Ω—è–π—Ç–µ –∫–æ–¥ –Ω–∞ Access Token —á–µ—Ä–µ–∑ OAuth

–ü–æ–¥—Ä–æ–±–Ω–µ–µ: [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è amoCRM API](https://www.amocrm.ru/developers/content/oauth/step-by-step)

## üì± –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Make.com

–î–æ–±–∞–≤—å—Ç–µ HTTP –º–æ–¥—É–ª—å –≤ –≤–∞—à —Å—Ü–µ–Ω–∞—Ä–∏–π:

1. **–ú–æ–¥—É–ª—å:** HTTP ‚Üí Make a request
2. **URL:** `https://your-app.up.railway.app/webhook/check-spam`
3. **Method:** POST
4. **Body type:** JSON
5. **Request content:**
```json
{
  "phone": "{{phone}}",
  "lead_id": {{lead_id}}
}
```

## üìä –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å–ø–∞–º–∞ SpravPortal

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
|-----------|----------|
| `spam` | –û–±—â–∏–π —Å–ø–∞–º |
| `fraud` | –ú–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ |
| `advertising` | –†–µ–∫–ª–∞–º–∞ |
| `survey` | –û–ø—Ä–æ—Å—ã |
| `collection` | –ö–æ–ª–ª–µ–∫—Ç–æ—Ä—ã |
| `unknown` | –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ |

## üõ† –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/your-repo/amocrm-spam-checker.git
cd amocrm-spam-checker

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
cp env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
npm start

# –ò–ª–∏ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (—Å –∞–≤—Ç–æ-–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π)
npm run dev
```

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## ü§ù –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã ‚Äî —Å–æ–∑–¥–∞–π—Ç–µ Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

